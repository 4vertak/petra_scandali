# BrickGame Тетрис

B проекте реализоваЛ игру «Тетрис» на языке программирования С с использованием структурного подхода.
Реализация «Тетрис» состоит из двух частей: библиотеки, реализующей логику работы игры, которую можно подключать к различным GUI в будущем, и терминального интерфейса. Логика работы библиотеки реализована с использованием конечных автоматов.

### Тетрис

![Тетрис](misc/images/tetris-game.png)

«Тетрис», наверное, одна из самых популярных игр для консоли Brickgame. Нередко и саму консоль называют тетрисом. Цель игры — в наборе очков за построение линий из генерируемых игрой блоков. Очередной блок, сгенерированный игрой, начинает опускаться вниз по игровому полю, пока не достигнет нижней границы или не столкнется с другим блоком. Пользовать может поворачивать фигуры и перемещать их по горизонтали, стараясь составлять ряды. После заполнения ряд уничтожается, игрок получает очки, а блоки, находящиеся выше заполненного ряда опускаются вниз. Игра заканчивается, когда очередная фигура останавливается в самом верхнем ряду.

Формализация логики данной игры предствалена следующим вариантом конечного автомата:

![Конечный автомат тетриса](misc/images/fsm-scheme.png)

Данный КА состоит из следующих состояний:

- START — состояние, в котором игра ждет, пока игрок нажмет кнопку готовности к игре.
- SPAWN — состояние, в которое переходит игра при создании очередного блока и выбора следующего блока для спавна.
- MOVING — основное игровое состояние с обработкой ввода от пользователя — поворот блоков/перемещение блоков по горизонтали.
- MOVE — состояние, в которое переходит игра после истечения таймера. В нем текущий блок перемещается вниз на один уровень.
- ATTACHING — состояние, в которое преходит игра после «соприкосновения» текущего блока с уже упавшими или с землей. Если образуются заполненные линии, то она уничтожается и остальные блоки смещаются вниз. Если блок остановился в самом верхнем ряду, то игра переходит в состояние «игра окончена».
- GAME_OVER — игра окончена.
- PAUSE - состояние,в которое переходит игра и ждет, пока игрок нажмет кнопку для продолжения игры.
- SAVE - состояние, в которое переходит игра и ждет, пока игрок нажмет кнопку для сохранения игры или выхода.
- LOADING - состояние, в которое переходит игра из состояния START, если есть сохранение и ждет пока игрок нажмет кнопку для загрузки игры.
- OPTIONS -  состояние, в которое переходит игра из состояния для подсказки кнопок управления.
- EXIT_STATE -  состояние, в котором происходит выход из игры.

## Чек лист по требованиям к проекту

### Часть 1. Основное задание

- [x] Программа должна быть разработана на языке Си стандарта C11 с использованием компилятора gcc.
- [x] Программа должна состоять из двух частей: библиотеки, реализующей логику игры тетрис, и терминального интерфейса с использованием библиотеки `ncurses`.
- [x] Для формализации логики игры должен быть использован конечный автомат.
- [x] Библиотека должна иметь функцию, принимающая на вход ввод пользователя, и функцию, выдающую матрицу, которая описывает текущее состояние игрового поля, при каждом ее изменении.
- [x] Код библиотеки программы должен находиться в папке `src/brick_game/tetris`.
- [x] Код с интерфейсом программы должен находиться в папке `src/gui/cli`.
- [x] Сборка программы должна быть настроена с помощью Makefile со стандартным набором целей для GNU-программ: all, install, uninstall, clean, dvi, dist, test, gcov_report. Установка должна вестись в любой другой произвольный каталог.
- [x] Программа должна быть разработана в соответствии с принципами структурного программирования.
- [x] При написании кода придерживайся Google Style.
- [x] Должно быть обеспечено покрытие библиотеки unit-тестами, с помощью библиотеки `check` (тесты должны проходить на ОС Darwin/Ubuntu). Покрытие библиотеки с логикой игры тестами должно составлять не меньше 80 процентов.
- [x] В игре должны присутствовать следующие механики:
  - [x] Вращение фигур;
  - [x] Перемещение фигуры по горизонтали;
  - [x] Ускорение падения фигуры;
  - [x] Показ следующей фигуры;
  - [x] Уничтожение заполненных линий;
  - [x] Завершение игры при достижении верхней границы игрового поля;
  - [x] В игре должны присутствовать все виды фигур, показанных на картинке ниже.
- [x] Для управления добавь поддержку всех кнопок, предусмотренных на физической консоли:
  - [x] Начало игры,
  - [x] Пауза,
  - [x] Завершение игры,
  - [x] Стрелка влево — движение фигуры влево,
  - [x] Стрелка вправо — движение фигуры вправо,
  - [x] Стрелка вниз — падение фигуры,
  - [x] Стрелка вверх — ни используется в данной игре,
  - [x] Действие (вращение фигуры).
- [x] Игровое поле должно соответствовать размерам игрового поля консоли — десять «пикселей» в ширину и двадцать «пикселей» в высоту.
- [x] Фигура, после достижения нижней границы поля или соприкосновения с другой фигурой, должна остановиться. После этого происходит генерация следующей фигуры, показанной на превью.
- [x] Интерфейс библиотеки должен соответствовать описанию, которое находится в materials/library-specification_RUS.md.
- [x] Пользовательский интерфейс должен поддерживать отрисовку игрового поля и дополнительной информации.
- [x] Подготовь в любом формате диаграмму, описывающую используемый КА (его состояния и все возможные переходы).

- [x] Используемые фигуры:

![Фигуры](misc/images/tetris-pieces.png)

### Часть 2. Дополнительно. Подсчет очков и рекорд в игре

Добавь в игру следующие механики:

- [x] подсчет очков;
- [x] хранение максимального количества очков.
- [x] дополнительно добавления возможность сохранения и загрузки игры.

- [x] Данная информация должна передаваться и выводиться пользовательским интерфейсом в боковой панели.
- [x] Максимальное количество очков и информация о сохраненной игре хранится  в встраиваемой СУБД (SQLite) и сохраняeся между запусками программы.

- [x] Максимальное количество очков должно изменяться во время игры, если пользователь во время игры превышает текущий показатель максимального количества набранных очков.

- [x] Начисление очков будет происходить следующим образом:

  - [x] 1 линия — 100 очков;
  - [x] 2 линии — 300 очков;
  - [x] 3 линии — 700 очков;
  - [x] 4 линии — 1500 очков.

### Часть 3. Дополнительно. Механика уровней

- [x] Добавь в игру механику уровней.
- [x] Каждый раз, когда игрок набирает 600 очков, уровень увеличивается на 1.
- [x] Повышение уровня увеличивает скорость движения фигур.
- [x] Максимальное количество уровней — 10.
